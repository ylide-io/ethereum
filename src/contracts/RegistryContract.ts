import { Contract } from 'web3-eth-contract';
import { AbiItem } from 'web3-utils';
import Web3 from 'web3';
import { publicKeyToBigIntString } from '../misc';
import SmartBuffer from '@ylide/smart-buffer';

export class RegistryContract {
	private readonly contractAddress: string;
	readonly contract: Contract;

	constructor(private readonly web3: Web3, contractAddress: string) {
		this.contractAddress = contractAddress;
		this.contract = new this.web3.eth.Contract(REGISTRY_ABI.abi as AbiItem[], this.contractAddress);
	}

	async estimateAndCall(address: string, method: string, args: any[]) {
		const data = this.web3.eth.abi.encodeFunctionCall(
			(REGISTRY_ABI.abi as AbiItem[]).find(t => t.name === method)!,
			args,
		);
		const gasPrice = await this.web3.eth.getGasPrice();
		const gas = await this.web3.eth.estimateGas({
			to: this.contract.options.address,
			from: address,
			data,
		});
		return await this.contract.methods[method](...args).send({ from: address, gas, gasPrice });
	}

	async estimateAndGetABI(address: string, method: string, args: any[], value?: string) {
		const data = this.web3.eth.abi.encodeFunctionCall(
			(REGISTRY_ABI.abi as AbiItem[]).find(t => t.name === method)!,
			args,
		);
		const gasPrice = await this.web3.eth.getGasPrice();
		const gas = await this.web3.eth.estimateGas({
			to: this.contract.options.address,
			from: address,
			data,
			value,
		});
		return {
			data: this.contract.methods[method](...args).encodeABI(),
			gas,
			gasPrice,
		};
	}

	async attachPublicKey(address: string, publicKey: Uint8Array, keyVersion: number): Promise<boolean> {
		await this.estimateAndCall(address, 'attachPublicKey', [publicKeyToBigIntString(publicKey), keyVersion]);
		return true;
	}

	async changeBonucer(from: string, newBonucer: string): Promise<any> {
		return await this.estimateAndCall(from, 'changeBonucer', [newBonucer]);
	}

	async setBonuses(from: string, _newcomerBonus: string, _referrerBonus: string): Promise<any> {
		return await this.estimateAndCall(from, 'setBonuses', [_newcomerBonus, _referrerBonus]);
	}

	// uint8 _v, bytes32 _r, bytes32 _s, address payable addr, uint256 publicKey, uint64 keyVersion, address payable referrer, bool payBonus
	async attachPublicKeyByAdmin(
		from: string,
		_v: number,
		_r: string,
		_s: string,
		address: string,
		publicKey: Uint8Array,
		keyVersion: number,
		referrer: string,
		payBonus: boolean,
		value: string,
	) {
		return await this.estimateAndGetABI(
			from,
			'attachPublicKeyByAdmin',
			[_v, _r, _s, address, publicKeyToBigIntString(publicKey), keyVersion, referrer, payBonus],
			value,
		);
	}

	static async getVersion(w3: Web3, registryAddress: string) {
		const contract = new w3.eth.Contract(REGISTRY_ABI.abi as AbiItem[], registryAddress);
		return w3.utils.toNumber(await contract.methods.version().call());
	}

	static async extractPublicKeyFromAddress(
		address: string,
		w3: Web3,
		registryAddress: string,
	): Promise<null | {
		block: number;
		keyVersion: number;
		publicKey: Uint8Array;
		timestamp: number;
	}> {
		const contract = new w3.eth.Contract(REGISTRY_ABI.abi as AbiItem[], registryAddress);
		const result = await contract.methods.addressToPublicKey(address).call();
		const block = Web3.utils.toNumber(result.block);
		const keyVersion = Web3.utils.toNumber(result.keyVersion);
		const publicKey = SmartBuffer.ofHexString(
			Web3.utils.toHex(result.publicKey).substring(2).padStart(64, '0'),
		).bytes;
		const timestamp = Web3.utils.toNumber(result.timestamp);
		return block === 0
			? null
			: {
					block,
					keyVersion,
					publicKey,
					timestamp,
			  };
		// if (result === '0' || result === '0x0') {
		// 	return null;
		// } else {
		// 	const hex = w3.utils.toHex(result);
		// 	return SmartBuffer.ofHexString(hex.substring(2).padStart(64, '0')).bytes;
		// }
	}

	static async deployContract(web3: Web3, from: string, previousContract?: string) {
		const contract = new web3.eth.Contract(REGISTRY_ABI.abi as AbiItem[]);
		const deployTx = contract.deploy({
			arguments: [previousContract ? previousContract : '0x0000000000000000000000000000000000000000'],
			data: REGISTRY_ABI.bytecode,
		});
		const tx = await deployTx.send({ from });
		return tx.options.address;
	}

	// async attachAddress(address: string, publicKey: Uint8Array): Promise<boolean> {
	// 	await this.estimateAndCall(address, 'attachAddress', [publicKeyToBigIntString(publicKey)]);
	// 	return true;
	// }
}

export const REGISTRY_ABI = {
	_format: 'hh-sol-artifact-1',
	contractName: 'YlideRegistryV4',
	sourceName: 'contracts/YlideRegistryV4.sol',
	abi: [
		{
			inputs: [
				{
					internalType: 'address',
					name: 'previousContractAddress',
					type: 'address',
				},
			],
			stateMutability: 'nonpayable',
			type: 'constructor',
		},
		{
			anonymous: false,
			inputs: [
				{
					indexed: true,
					internalType: 'address',
					name: 'addr',
					type: 'address',
				},
				{
					indexed: false,
					internalType: 'uint256',
					name: 'publicKey',
					type: 'uint256',
				},
				{
					indexed: false,
					internalType: 'uint64',
					name: 'keyVersion',
					type: 'uint64',
				},
			],
			name: 'KeyAttached',
			type: 'event',
		},
		{
			inputs: [
				{
					internalType: 'address',
					name: '',
					type: 'address',
				},
			],
			name: 'addressToPublicKey',
			outputs: [
				{
					internalType: 'uint256',
					name: 'publicKey',
					type: 'uint256',
				},
				{
					internalType: 'uint128',
					name: 'block',
					type: 'uint128',
				},
				{
					internalType: 'uint64',
					name: 'timestamp',
					type: 'uint64',
				},
				{
					internalType: 'uint64',
					name: 'keyVersion',
					type: 'uint64',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint256',
					name: 'publicKey',
					type: 'uint256',
				},
				{
					internalType: 'uint64',
					name: 'keyVersion',
					type: 'uint64',
				},
			],
			name: 'attachPublicKey',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint8',
					name: '_v',
					type: 'uint8',
				},
				{
					internalType: 'bytes32',
					name: '_r',
					type: 'bytes32',
				},
				{
					internalType: 'bytes32',
					name: '_s',
					type: 'bytes32',
				},
				{
					internalType: 'address payable',
					name: 'addr',
					type: 'address',
				},
				{
					internalType: 'uint256',
					name: 'publicKey',
					type: 'uint256',
				},
				{
					internalType: 'uint64',
					name: 'keyVersion',
					type: 'uint64',
				},
				{
					internalType: 'address payable',
					name: 'referrer',
					type: 'address',
				},
				{
					internalType: 'bool',
					name: 'payBonus',
					type: 'bool',
				},
			],
			name: 'attachPublicKeyByAdmin',
			outputs: [],
			stateMutability: 'payable',
			type: 'function',
		},
		{
			inputs: [],
			name: 'bonucer',
			outputs: [
				{
					internalType: 'address',
					name: '',
					type: 'address',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'address',
					name: 'newBonucer',
					type: 'address',
				},
			],
			name: 'changeBonucer',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'address',
					name: 'addr',
					type: 'address',
				},
			],
			name: 'getPublicKey',
			outputs: [
				{
					components: [
						{
							internalType: 'uint256',
							name: 'publicKey',
							type: 'uint256',
						},
						{
							internalType: 'uint128',
							name: 'block',
							type: 'uint128',
						},
						{
							internalType: 'uint64',
							name: 'timestamp',
							type: 'uint64',
						},
						{
							internalType: 'uint64',
							name: 'keyVersion',
							type: 'uint64',
						},
					],
					internalType: 'struct RegistryEntry',
					name: 'entry',
					type: 'tuple',
				},
				{
					internalType: 'uint256',
					name: 'contractVersion',
					type: 'uint256',
				},
				{
					internalType: 'address',
					name: 'contractAddress',
					type: 'address',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'bytes32',
					name: 'buffer',
					type: 'bytes32',
				},
			],
			name: 'iToHex',
			outputs: [
				{
					internalType: 'bytes',
					name: '',
					type: 'bytes',
				},
			],
			stateMutability: 'pure',
			type: 'function',
		},
		{
			inputs: [],
			name: 'newcomerBonus',
			outputs: [
				{
					internalType: 'uint256',
					name: '',
					type: 'uint256',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [],
			name: 'owner',
			outputs: [
				{
					internalType: 'address',
					name: '',
					type: 'address',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [],
			name: 'referrerBonus',
			outputs: [
				{
					internalType: 'uint256',
					name: '',
					type: 'uint256',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint256',
					name: '_newcomerBonus',
					type: 'uint256',
				},
				{
					internalType: 'uint256',
					name: '_referrerBonus',
					type: 'uint256',
				},
			],
			name: 'setBonuses',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [],
			name: 'terminate',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'address',
					name: 'newOwner',
					type: 'address',
				},
			],
			name: 'transferOwnership',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'bytes32',
					name: 'publicKey',
					type: 'bytes32',
				},
				{
					internalType: 'uint8',
					name: '_v',
					type: 'uint8',
				},
				{
					internalType: 'bytes32',
					name: '_r',
					type: 'bytes32',
				},
				{
					internalType: 'bytes32',
					name: '_s',
					type: 'bytes32',
				},
			],
			name: 'verifyMessage',
			outputs: [
				{
					internalType: 'address',
					name: '',
					type: 'address',
				},
			],
			stateMutability: 'pure',
			type: 'function',
		},
		{
			inputs: [],
			name: 'version',
			outputs: [
				{
					internalType: 'uint256',
					name: '',
					type: 'uint256',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
	],
	bytecode:
		'0x60806040526004600255600060055560006006553480156200002057600080fd5b50604051620021bd380380620021bd833981810160405281019062000046919062000179565b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050620001ab565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000620001418262000114565b9050919050565b620001538162000134565b81146200015f57600080fd5b50565b600081519050620001738162000148565b92915050565b6000602082840312156200019257620001916200010f565b5b6000620001a28482850162000162565b91505092915050565b61200280620001bb6000396000f3fe6080604052600436106100e85760003560e01c8063857cdbb81161008a578063d3cf32df11610059578063d3cf32df146102dc578063e952357914610319578063f2fde38b14610342578063fd9c43fe1461036b576100e8565b8063857cdbb81461021e5780638da5cb5b1461025d578063b814e8c514610288578063ce14686d146102b3576100e8565b80633ff30264116100c65780633ff302641461014b5780634bae2ef11461018857806354fd4d50146101b357806369f465b6146101de576100e8565b80630c08bf88146100ed57806313e2f86a1461010457806331f5629814610120575b600080fd5b3480156100f957600080fd5b50610102610394565b005b61011e60048036038101906101199190611516565b610425565b005b34801561012c57600080fd5b50610135610978565b60405161014291906115db565b60405180910390f35b34801561015757600080fd5b50610172600480360381019061016d91906115f6565b61097e565b60405161017f91906116bc565b60405180910390f35b34801561019457600080fd5b5061019d610b79565b6040516101aa91906115db565b60405180910390f35b3480156101bf57600080fd5b506101c8610b7f565b6040516101d591906115db565b60405180910390f35b3480156101ea57600080fd5b506102056004803603810190610200919061171c565b610b85565b6040516102159493929190611783565b60405180910390f35b34801561022a57600080fd5b506102456004803603810190610240919061171c565b610bf9565b60405161025493929190611859565b60405180910390f35b34801561026957600080fd5b50610272610e40565b60405161027f9190611890565b60405180910390f35b34801561029457600080fd5b5061029d610e64565b6040516102aa9190611890565b60405180910390f35b3480156102bf57600080fd5b506102da60048036038101906102d591906118ab565b610e8a565b005b3480156102e857600080fd5b5061030360048036038101906102fe91906118eb565b61105c565b6040516103109190611890565b60405180910390f35b34801561032557600080fd5b50610340600480360381019061033b9190611952565b611133565b005b34801561034e57600080fd5b506103696004803603810190610364919061171c565b61119d565b005b34801561037757600080fd5b50610392600480360381019061038d919061171c565b61126d565b005b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146103ec57600080fd5b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461047f57600080fd5b60008367ffffffffffffffff1614156104cd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104c4906119ef565b60405180910390fd5b8473ffffffffffffffffffffffffffffffffffffffff166104f38560001b8a8a8a61105c565b73ffffffffffffffffffffffffffffffffffffffff1614610549576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161054090611a81565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614806105e557506000600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160189054906101000a900467ffffffffffffffff1667ffffffffffffffff1614155b610624576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161061b90611aed565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff16141580156106c157506000600360008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160189054906101000a900467ffffffffffffffff1667ffffffffffffffff16145b610700576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106f790611b7f565b60405180910390fd5b6040518060800160405280858152602001436fffffffffffffffffffffffffffffffff1681526020014267ffffffffffffffff1681526020018467ffffffffffffffff16815250600360008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060408201518160010160106101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060608201518160010160186101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055509050508473ffffffffffffffffffffffffffffffffffffffff167f3bd1fbfb1052b4dedf1d8b9fffd2ffd4624e689f83b75a192b9e824982633df48585604051610878929190611b9f565b60405180910390a28080156108905750600060055414155b156108df578473ffffffffffffffffffffffffffffffffffffffff166108fc6005549081150290604051600060405180830381858888f193505050501580156108dd573d6000803e3d6000fd5b505b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415801561091f5750600060065414155b1561096e578173ffffffffffffffffffffffffffffffffffffffff166108fc6006549081150290604051600060405180830381858888f1935050505015801561096c573d6000803e3d6000fd5b505b5050505050505050565b60055481565b60606000604067ffffffffffffffff81111561099d5761099c611bc8565b5b6040519080825280601f01601f1916602001820160405280156109cf5781602001600182028036833780820191505090505b50905060006040518060400160405280601081526020017f3031323334353637383961626364656600000000000000000000000000000000815250905060005b60208160ff161015610b6e57818251868360ff1660208110610a3457610a33611bf7565b5b1a60f81b60f81c60ff16610a489190611c84565b81518110610a5957610a58611bf7565b5b602001015160f81c60f81b83600283610a729190611cb5565b60ff1681518110610a8657610a85611bf7565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350818251868360ff1660208110610ace57610acd611bf7565b5b1a60f81b60f81c60ff16610ae29190611cf0565b81518110610af357610af2611bf7565b5b602001015160f81c60f81b836001600284610b0e9190611cb5565b610b189190611d21565b60ff1681518110610b2c57610b2b611bf7565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080610b6690611d58565b915050610a0f565b508192505050919050565b60065481565b60025481565b60036020528060005260406000206000915090508060000154908060010160009054906101000a90046fffffffffffffffffffffffffffffffff16908060010160109054906101000a900467ffffffffffffffff16908060010160189054906101000a900467ffffffffffffffff16905084565b610c0161133e565b6000806002549150309050600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020604051806080016040529081600082015481526020016001820160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020016001820160109054906101000a900467ffffffffffffffff1667ffffffffffffffff1667ffffffffffffffff1681526020016001820160189054906101000a900467ffffffffffffffff1667ffffffffffffffff1667ffffffffffffffff168152505092506000836060015167ffffffffffffffff16148015610d7d5750600073ffffffffffffffffffffffffffffffffffffffff16600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614155b15610e3857600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663857cdbb8856040518263ffffffff1660e01b8152600401610ddd9190611890565b60c06040518083038186803b158015610df557600080fd5b505afa158015610e09573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610e2d9190611eb6565b925092509250610e39565b5b9193909250565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008167ffffffffffffffff161415610ed8576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610ecf906119ef565b60405180910390fd5b6040518060800160405280838152602001436fffffffffffffffffffffffffffffffff1681526020014267ffffffffffffffff1681526020018267ffffffffffffffff16815250600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060408201518160010160106101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060608201518160010160186101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055509050503373ffffffffffffffffffffffffffffffffffffffff167f3bd1fbfb1052b4dedf1d8b9fffd2ffd4624e689f83b75a192b9e824982633df48383604051611050929190611b9f565b60405180910390a25050565b6000806040518060400160405280601c81526020017f19457468657265756d205369676e6564204d6573736167653a0a363400000000815250905060006110a28761097e565b9050600082826040516020016110b9929190611f45565b6040516020818303038152906040528051906020012090506000600182898989604051600081526020016040526040516110f69493929190611f87565b6020604051602081039080840390855afa158015611118573d6000803e3d6000fd5b50505060206040510351905080945050505050949350505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461118b57600080fd5b81600581905550806006819055505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146111f557600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461126a57806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b50565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146112c557600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461133b5780600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b50565b60405180608001604052806000815260200160006fffffffffffffffffffffffffffffffff168152602001600067ffffffffffffffff168152602001600067ffffffffffffffff1681525090565b6000604051905090565b600080fd5b600060ff82169050919050565b6113b18161139b565b81146113bc57600080fd5b50565b6000813590506113ce816113a8565b92915050565b6000819050919050565b6113e7816113d4565b81146113f257600080fd5b50565b600081359050611404816113de565b92915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006114358261140a565b9050919050565b6114458161142a565b811461145057600080fd5b50565b6000813590506114628161143c565b92915050565b6000819050919050565b61147b81611468565b811461148657600080fd5b50565b60008135905061149881611472565b92915050565b600067ffffffffffffffff82169050919050565b6114bb8161149e565b81146114c657600080fd5b50565b6000813590506114d8816114b2565b92915050565b60008115159050919050565b6114f3816114de565b81146114fe57600080fd5b50565b600081359050611510816114ea565b92915050565b600080600080600080600080610100898b03121561153757611536611396565b5b60006115458b828c016113bf565b98505060206115568b828c016113f5565b97505060406115678b828c016113f5565b96505060606115788b828c01611453565b95505060806115898b828c01611489565b94505060a061159a8b828c016114c9565b93505060c06115ab8b828c01611453565b92505060e06115bc8b828c01611501565b9150509295985092959890939650565b6115d581611468565b82525050565b60006020820190506115f060008301846115cc565b92915050565b60006020828403121561160c5761160b611396565b5b600061161a848285016113f5565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561165d578082015181840152602081019050611642565b8381111561166c576000848401525b50505050565b6000601f19601f8301169050919050565b600061168e82611623565b611698818561162e565b93506116a881856020860161163f565b6116b181611672565b840191505092915050565b600060208201905081810360008301526116d68184611683565b905092915050565b60006116e98261140a565b9050919050565b6116f9816116de565b811461170457600080fd5b50565b600081359050611716816116f0565b92915050565b60006020828403121561173257611731611396565b5b600061174084828501611707565b91505092915050565b60006fffffffffffffffffffffffffffffffff82169050919050565b61176e81611749565b82525050565b61177d8161149e565b82525050565b600060808201905061179860008301876115cc565b6117a56020830186611765565b6117b26040830185611774565b6117bf6060830184611774565b95945050505050565b6117d181611468565b82525050565b6117e081611749565b82525050565b6117ef8161149e565b82525050565b60808201600082015161180b60008501826117c8565b50602082015161181e60208501826117d7565b50604082015161183160408501826117e6565b50606082015161184460608501826117e6565b50505050565b611853816116de565b82525050565b600060c08201905061186e60008301866117f5565b61187b60808301856115cc565b61188860a083018461184a565b949350505050565b60006020820190506118a5600083018461184a565b92915050565b600080604083850312156118c2576118c1611396565b5b60006118d085828601611489565b92505060206118e1858286016114c9565b9150509250929050565b6000806000806080858703121561190557611904611396565b5b6000611913878288016113f5565b9450506020611924878288016113bf565b9350506040611935878288016113f5565b9250506060611946878288016113f5565b91505092959194509250565b6000806040838503121561196957611968611396565b5b600061197785828601611489565b925050602061198885828601611489565b9150509250929050565b600082825260208201905092915050565b7f4b65792076657273696f6e206d7573742062652061626f7665207a65726f0000600082015250565b60006119d9601e83611992565b91506119e4826119a3565b602082019050919050565b60006020820190508181036000830152611a08816119cc565b9050919050565b7f5369676e617475726520646f6573206e6f74206d61746368207468652075736560008201527f7273206164647265737300000000000000000000000000000000000000000000602082015250565b6000611a6b602a83611992565b9150611a7682611a0f565b604082019050919050565b60006020820190508181036000830152611a9a81611a5e565b9050919050565b7f5265666572726572206d75737420626520726567697374657265640000000000600082015250565b6000611ad7601b83611992565b9150611ae282611aa1565b602082019050919050565b60006020820190508181036000830152611b0681611aca565b9050919050565b7f4f6e6c79206e65772075736572206b65792063616e2062652061737369676e6560008201527f642062792061646d696e00000000000000000000000000000000000000000000602082015250565b6000611b69602a83611992565b9150611b7482611b0d565b604082019050919050565b60006020820190508181036000830152611b9881611b5c565b9050919050565b6000604082019050611bb460008301856115cc565b611bc16020830184611774565b9392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000611c8f82611468565b9150611c9a83611468565b925082611caa57611ca9611c26565b5b828204905092915050565b6000611cc08261139b565b9150611ccb8361139b565b92508160ff0483118215151615611ce557611ce4611c55565b5b828202905092915050565b6000611cfb82611468565b9150611d0683611468565b925082611d1657611d15611c26565b5b828206905092915050565b6000611d2c8261139b565b9150611d378361139b565b92508260ff03821115611d4d57611d4c611c55565b5b828201905092915050565b6000611d638261139b565b915060ff821415611d7757611d76611c55565b5b600182019050919050565b600080fd5b611d9082611672565b810181811067ffffffffffffffff82111715611daf57611dae611bc8565b5b80604052505050565b6000611dc261138c565b9050611dce8282611d87565b919050565b600081519050611de281611472565b92915050565b611df181611749565b8114611dfc57600080fd5b50565b600081519050611e0e81611de8565b92915050565b600081519050611e23816114b2565b92915050565b600060808284031215611e3f57611e3e611d82565b5b611e496080611db8565b90506000611e5984828501611dd3565b6000830152506020611e6d84828501611dff565b6020830152506040611e8184828501611e14565b6040830152506060611e9584828501611e14565b60608301525092915050565b600081519050611eb0816116f0565b92915050565b600080600060c08486031215611ecf57611ece611396565b5b6000611edd86828701611e29565b9350506080611eee86828701611dd3565b92505060a0611eff86828701611ea1565b9150509250925092565b600081905092915050565b6000611f1f82611623565b611f298185611f09565b9350611f3981856020860161163f565b80840191505092915050565b6000611f518285611f14565b9150611f5d8284611f14565b91508190509392505050565b611f72816113d4565b82525050565b611f818161139b565b82525050565b6000608082019050611f9c6000830187611f69565b611fa96020830186611f78565b611fb66040830185611f69565b611fc36060830184611f69565b9594505050505056fea264697066735822122049cfded0df50759ce728417bbb29bd91b881388cb30c6cd8a9082d404f862e6f64736f6c63430008090033',
	deployedBytecode:
		'0x6080604052600436106100e85760003560e01c8063857cdbb81161008a578063d3cf32df11610059578063d3cf32df146102dc578063e952357914610319578063f2fde38b14610342578063fd9c43fe1461036b576100e8565b8063857cdbb81461021e5780638da5cb5b1461025d578063b814e8c514610288578063ce14686d146102b3576100e8565b80633ff30264116100c65780633ff302641461014b5780634bae2ef11461018857806354fd4d50146101b357806369f465b6146101de576100e8565b80630c08bf88146100ed57806313e2f86a1461010457806331f5629814610120575b600080fd5b3480156100f957600080fd5b50610102610394565b005b61011e60048036038101906101199190611516565b610425565b005b34801561012c57600080fd5b50610135610978565b60405161014291906115db565b60405180910390f35b34801561015757600080fd5b50610172600480360381019061016d91906115f6565b61097e565b60405161017f91906116bc565b60405180910390f35b34801561019457600080fd5b5061019d610b79565b6040516101aa91906115db565b60405180910390f35b3480156101bf57600080fd5b506101c8610b7f565b6040516101d591906115db565b60405180910390f35b3480156101ea57600080fd5b506102056004803603810190610200919061171c565b610b85565b6040516102159493929190611783565b60405180910390f35b34801561022a57600080fd5b506102456004803603810190610240919061171c565b610bf9565b60405161025493929190611859565b60405180910390f35b34801561026957600080fd5b50610272610e40565b60405161027f9190611890565b60405180910390f35b34801561029457600080fd5b5061029d610e64565b6040516102aa9190611890565b60405180910390f35b3480156102bf57600080fd5b506102da60048036038101906102d591906118ab565b610e8a565b005b3480156102e857600080fd5b5061030360048036038101906102fe91906118eb565b61105c565b6040516103109190611890565b60405180910390f35b34801561032557600080fd5b50610340600480360381019061033b9190611952565b611133565b005b34801561034e57600080fd5b506103696004803603810190610364919061171c565b61119d565b005b34801561037757600080fd5b50610392600480360381019061038d919061171c565b61126d565b005b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146103ec57600080fd5b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461047f57600080fd5b60008367ffffffffffffffff1614156104cd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104c4906119ef565b60405180910390fd5b8473ffffffffffffffffffffffffffffffffffffffff166104f38560001b8a8a8a61105c565b73ffffffffffffffffffffffffffffffffffffffff1614610549576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161054090611a81565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614806105e557506000600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160189054906101000a900467ffffffffffffffff1667ffffffffffffffff1614155b610624576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161061b90611aed565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff16141580156106c157506000600360008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160189054906101000a900467ffffffffffffffff1667ffffffffffffffff16145b610700576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106f790611b7f565b60405180910390fd5b6040518060800160405280858152602001436fffffffffffffffffffffffffffffffff1681526020014267ffffffffffffffff1681526020018467ffffffffffffffff16815250600360008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060408201518160010160106101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060608201518160010160186101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055509050508473ffffffffffffffffffffffffffffffffffffffff167f3bd1fbfb1052b4dedf1d8b9fffd2ffd4624e689f83b75a192b9e824982633df48585604051610878929190611b9f565b60405180910390a28080156108905750600060055414155b156108df578473ffffffffffffffffffffffffffffffffffffffff166108fc6005549081150290604051600060405180830381858888f193505050501580156108dd573d6000803e3d6000fd5b505b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415801561091f5750600060065414155b1561096e578173ffffffffffffffffffffffffffffffffffffffff166108fc6006549081150290604051600060405180830381858888f1935050505015801561096c573d6000803e3d6000fd5b505b5050505050505050565b60055481565b60606000604067ffffffffffffffff81111561099d5761099c611bc8565b5b6040519080825280601f01601f1916602001820160405280156109cf5781602001600182028036833780820191505090505b50905060006040518060400160405280601081526020017f3031323334353637383961626364656600000000000000000000000000000000815250905060005b60208160ff161015610b6e57818251868360ff1660208110610a3457610a33611bf7565b5b1a60f81b60f81c60ff16610a489190611c84565b81518110610a5957610a58611bf7565b5b602001015160f81c60f81b83600283610a729190611cb5565b60ff1681518110610a8657610a85611bf7565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350818251868360ff1660208110610ace57610acd611bf7565b5b1a60f81b60f81c60ff16610ae29190611cf0565b81518110610af357610af2611bf7565b5b602001015160f81c60f81b836001600284610b0e9190611cb5565b610b189190611d21565b60ff1681518110610b2c57610b2b611bf7565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080610b6690611d58565b915050610a0f565b508192505050919050565b60065481565b60025481565b60036020528060005260406000206000915090508060000154908060010160009054906101000a90046fffffffffffffffffffffffffffffffff16908060010160109054906101000a900467ffffffffffffffff16908060010160189054906101000a900467ffffffffffffffff16905084565b610c0161133e565b6000806002549150309050600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020604051806080016040529081600082015481526020016001820160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020016001820160109054906101000a900467ffffffffffffffff1667ffffffffffffffff1667ffffffffffffffff1681526020016001820160189054906101000a900467ffffffffffffffff1667ffffffffffffffff1667ffffffffffffffff168152505092506000836060015167ffffffffffffffff16148015610d7d5750600073ffffffffffffffffffffffffffffffffffffffff16600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614155b15610e3857600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663857cdbb8856040518263ffffffff1660e01b8152600401610ddd9190611890565b60c06040518083038186803b158015610df557600080fd5b505afa158015610e09573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610e2d9190611eb6565b925092509250610e39565b5b9193909250565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008167ffffffffffffffff161415610ed8576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610ecf906119ef565b60405180910390fd5b6040518060800160405280838152602001436fffffffffffffffffffffffffffffffff1681526020014267ffffffffffffffff1681526020018267ffffffffffffffff16815250600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060408201518160010160106101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060608201518160010160186101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055509050503373ffffffffffffffffffffffffffffffffffffffff167f3bd1fbfb1052b4dedf1d8b9fffd2ffd4624e689f83b75a192b9e824982633df48383604051611050929190611b9f565b60405180910390a25050565b6000806040518060400160405280601c81526020017f19457468657265756d205369676e6564204d6573736167653a0a363400000000815250905060006110a28761097e565b9050600082826040516020016110b9929190611f45565b6040516020818303038152906040528051906020012090506000600182898989604051600081526020016040526040516110f69493929190611f87565b6020604051602081039080840390855afa158015611118573d6000803e3d6000fd5b50505060206040510351905080945050505050949350505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461118b57600080fd5b81600581905550806006819055505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146111f557600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461126a57806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b50565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146112c557600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461133b5780600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b50565b60405180608001604052806000815260200160006fffffffffffffffffffffffffffffffff168152602001600067ffffffffffffffff168152602001600067ffffffffffffffff1681525090565b6000604051905090565b600080fd5b600060ff82169050919050565b6113b18161139b565b81146113bc57600080fd5b50565b6000813590506113ce816113a8565b92915050565b6000819050919050565b6113e7816113d4565b81146113f257600080fd5b50565b600081359050611404816113de565b92915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006114358261140a565b9050919050565b6114458161142a565b811461145057600080fd5b50565b6000813590506114628161143c565b92915050565b6000819050919050565b61147b81611468565b811461148657600080fd5b50565b60008135905061149881611472565b92915050565b600067ffffffffffffffff82169050919050565b6114bb8161149e565b81146114c657600080fd5b50565b6000813590506114d8816114b2565b92915050565b60008115159050919050565b6114f3816114de565b81146114fe57600080fd5b50565b600081359050611510816114ea565b92915050565b600080600080600080600080610100898b03121561153757611536611396565b5b60006115458b828c016113bf565b98505060206115568b828c016113f5565b97505060406115678b828c016113f5565b96505060606115788b828c01611453565b95505060806115898b828c01611489565b94505060a061159a8b828c016114c9565b93505060c06115ab8b828c01611453565b92505060e06115bc8b828c01611501565b9150509295985092959890939650565b6115d581611468565b82525050565b60006020820190506115f060008301846115cc565b92915050565b60006020828403121561160c5761160b611396565b5b600061161a848285016113f5565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561165d578082015181840152602081019050611642565b8381111561166c576000848401525b50505050565b6000601f19601f8301169050919050565b600061168e82611623565b611698818561162e565b93506116a881856020860161163f565b6116b181611672565b840191505092915050565b600060208201905081810360008301526116d68184611683565b905092915050565b60006116e98261140a565b9050919050565b6116f9816116de565b811461170457600080fd5b50565b600081359050611716816116f0565b92915050565b60006020828403121561173257611731611396565b5b600061174084828501611707565b91505092915050565b60006fffffffffffffffffffffffffffffffff82169050919050565b61176e81611749565b82525050565b61177d8161149e565b82525050565b600060808201905061179860008301876115cc565b6117a56020830186611765565b6117b26040830185611774565b6117bf6060830184611774565b95945050505050565b6117d181611468565b82525050565b6117e081611749565b82525050565b6117ef8161149e565b82525050565b60808201600082015161180b60008501826117c8565b50602082015161181e60208501826117d7565b50604082015161183160408501826117e6565b50606082015161184460608501826117e6565b50505050565b611853816116de565b82525050565b600060c08201905061186e60008301866117f5565b61187b60808301856115cc565b61188860a083018461184a565b949350505050565b60006020820190506118a5600083018461184a565b92915050565b600080604083850312156118c2576118c1611396565b5b60006118d085828601611489565b92505060206118e1858286016114c9565b9150509250929050565b6000806000806080858703121561190557611904611396565b5b6000611913878288016113f5565b9450506020611924878288016113bf565b9350506040611935878288016113f5565b9250506060611946878288016113f5565b91505092959194509250565b6000806040838503121561196957611968611396565b5b600061197785828601611489565b925050602061198885828601611489565b9150509250929050565b600082825260208201905092915050565b7f4b65792076657273696f6e206d7573742062652061626f7665207a65726f0000600082015250565b60006119d9601e83611992565b91506119e4826119a3565b602082019050919050565b60006020820190508181036000830152611a08816119cc565b9050919050565b7f5369676e617475726520646f6573206e6f74206d61746368207468652075736560008201527f7273206164647265737300000000000000000000000000000000000000000000602082015250565b6000611a6b602a83611992565b9150611a7682611a0f565b604082019050919050565b60006020820190508181036000830152611a9a81611a5e565b9050919050565b7f5265666572726572206d75737420626520726567697374657265640000000000600082015250565b6000611ad7601b83611992565b9150611ae282611aa1565b602082019050919050565b60006020820190508181036000830152611b0681611aca565b9050919050565b7f4f6e6c79206e65772075736572206b65792063616e2062652061737369676e6560008201527f642062792061646d696e00000000000000000000000000000000000000000000602082015250565b6000611b69602a83611992565b9150611b7482611b0d565b604082019050919050565b60006020820190508181036000830152611b9881611b5c565b9050919050565b6000604082019050611bb460008301856115cc565b611bc16020830184611774565b9392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000611c8f82611468565b9150611c9a83611468565b925082611caa57611ca9611c26565b5b828204905092915050565b6000611cc08261139b565b9150611ccb8361139b565b92508160ff0483118215151615611ce557611ce4611c55565b5b828202905092915050565b6000611cfb82611468565b9150611d0683611468565b925082611d1657611d15611c26565b5b828206905092915050565b6000611d2c8261139b565b9150611d378361139b565b92508260ff03821115611d4d57611d4c611c55565b5b828201905092915050565b6000611d638261139b565b915060ff821415611d7757611d76611c55565b5b600182019050919050565b600080fd5b611d9082611672565b810181811067ffffffffffffffff82111715611daf57611dae611bc8565b5b80604052505050565b6000611dc261138c565b9050611dce8282611d87565b919050565b600081519050611de281611472565b92915050565b611df181611749565b8114611dfc57600080fd5b50565b600081519050611e0e81611de8565b92915050565b600081519050611e23816114b2565b92915050565b600060808284031215611e3f57611e3e611d82565b5b611e496080611db8565b90506000611e5984828501611dd3565b6000830152506020611e6d84828501611dff565b6020830152506040611e8184828501611e14565b6040830152506060611e9584828501611e14565b60608301525092915050565b600081519050611eb0816116f0565b92915050565b600080600060c08486031215611ecf57611ece611396565b5b6000611edd86828701611e29565b9350506080611eee86828701611dd3565b92505060a0611eff86828701611ea1565b9150509250925092565b600081905092915050565b6000611f1f82611623565b611f298185611f09565b9350611f3981856020860161163f565b80840191505092915050565b6000611f518285611f14565b9150611f5d8284611f14565b91508190509392505050565b611f72816113d4565b82525050565b611f818161139b565b82525050565b6000608082019050611f9c6000830187611f69565b611fa96020830186611f78565b611fb66040830185611f69565b611fc36060830184611f69565b9594505050505056fea264697066735822122049cfded0df50759ce728417bbb29bd91b881388cb30c6cd8a9082d404f862e6f64736f6c63430008090033',
	linkReferences: {},
	deployedLinkReferences: {},
};
